<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Socket.IO 예제</title>
</head>
<body>
    <div style="float: left; width: 50%;">
        <div id = "control" style="display: none;">
            <form id="rock">
                <button type="submit">rock</button>
            </form>
            
            <form id="scissor">
                <button type="submit">scissor</button>
            </form>
    
            <form id="paper">
                <button type="submit">paper</button>
            </form>
        
            <form id="ready">
                <button type="submit">ready</button>
            </form>
        </div>
        <ul id="messages" type="none">
            
        </ul>
    </div>
    <div style="float: left;">
        <textarea id="chatarea" style="width: 400px; height: 500px;"></textarea>
        <form id="chatform">
            <input id="chatinput" autocomplete="off" type="text">
            <button type="submit">Send</button>
        </form>
    </div>
    <div style="float: left;">
        <button onclick="showLobbyUserList()">Show User List</button>
        <ul id="userlist" style="display: none;">
            
        </ul>
    </div>
    

    <script src="/socket.io/socket.io.js"></script>
    <script>
        var inputname = "<%= username %>"; // 유저 이름 입력 받기
        var roomname = "<%= roomname %>";
        var socket = io('/game');
        socket.emit('newPlayer', roomname);

        var rock = document.getElementById('rock');
        var scissor = document.getElementById('scissor');
        var paper = document.getElementById('paper');
        var ready = document.getElementById('ready');
        var chatform = document.getElementById('chatform');

        function showLobbyUserList() {
            var userlist = document.getElementById('userlist');
            if(document.getElementById('userlist').style.display == 'none') {
                document.getElementById('userlist').style.display = "block";
                socket.emit('reqLobbyUserList');
            } else {
                document.getElementById('userlist').style.display = "none";
            }
        }

        function invite(id) {
            var button = document.getElementById(id);
            button.innerHTML = 'Invited';
            button.disabled = true;
            socket.emit('reqInviteUser', id);
        }

        socket.on('startGame', (data) => { // 게임 시작됩을 알려주는 응답
            
            socket.emit('reqGameData');
        });

        // 메시지 수신시 HTML에 메시지 내용 작성
        socket.on('message', (msg) => {
            var messageList = document.getElementById('messages');
            var messageTag = document.createElement("li");
            messageTag.innerText = msg;
            messageList.appendChild(messageTag);
            socket.emit('reqGameData');
        });

        socket.on('emitChat', (msg, username) => {
            var chatarea = document.getElementById('chatarea');
            chatarea.append("\n" + username + " : " + msg);
        });
        
        socket.on('resLobbyUserList', (data) => {
            var userList = document.getElementById('userlist');
            userList.innerHTML = '';
            data.forEach((elem) => {
                userList.innerHTML += `
                <li >${elem.username}<button onclick="getUserData('${elem.username}')" >Show Data</button><button id="${elem.id}" onclick="invite('${elem.id}')" >Invite</button></li>
                `;
            });
        });
    </script>
</body>
</html>